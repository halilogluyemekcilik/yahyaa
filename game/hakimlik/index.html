<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="HMGS ve Hakimlik/SavcÄ±lÄ±k sÄ±nav sonuÃ§larÄ±nÄ±zÄ± takip edin ve analiz edin. Mobil uygulama gibi Ã§alÄ±ÅŸÄ±r.">
    <meta name="keywords" content="hmgs, hakimlik, savcÄ±lÄ±k, sÄ±nav, takip, sonuÃ§, analiz, puan, net, geliÅŸim">
    <meta name="author" content="SÄ±nav Takip Sistemi">

    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SÄ±nav Takip">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="/browserconfig.xml">

    <link rel="manifest" href="manifest.json">

    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <title>HMGS/Hakimlik-SavcÄ±lÄ±k SÄ±nav Takip Sistemi</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ“ˆ HMGS/Hakimlik-SavcÄ±lÄ±k GeliÅŸim Takip Sistemi</h1>
            <p>SÄ±nav sonuÃ§larÄ±nÄ±zÄ± takip edin ve geliÅŸiminizi analiz edin</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2>Yeni SÄ±nav Sonucu Ekle</h2>
                <form id="examForm">
                    <div class="form-group">
                        <label for="examName">SÄ±nav AdÄ±:</label>
                        <input type="text" id="examName" placeholder="Ã–rn: 1. Deneme" required>
                    </div>

                    <div class="form-group">
                        <label for="examType">SÄ±nav TÃ¼rÃ¼:</label>
                        <select id="examType" class="form-control">
                            <option value="hmgs">HMGS</option>
                            <option value="hakimlik-savcilik" selected>Hakimlik/SavcÄ±lÄ±k</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="examDate">SÄ±nav Tarihi:</label>
                        <input type="date" id="examDate" required>
                    </div>

                    <div class="form-group">
                        <label for="totalQuestions">Toplam Soru SayÄ±sÄ±:</label>
                        <input type="number" id="totalQuestions" min="1" value="100" readonly>
                        <small style="color: #718096; font-size: 0.9rem;">SÄ±nav tÃ¼rÃ¼ne gÃ¶re otomatik gÃ¼ncellenir</small>
                    </div>

                    <button type="submit" class="btn-submit">SÄ±navÄ± BaÅŸlat</button>
                </form>

                <div class="current-exam" id="currentExam" style="display: none;">
                    <h3>Aktif SÄ±nav: <span id="currentExamName"></span> (<span id="currentExamType"></span>)</h3>
                    <p>Tarih: <span id="currentExamDate"></span></p>
                    <p>Toplam Soru: <span id="currentExamTotal"></span></p>
                    <button type="button" class="btn-finish" onclick="finishExam()">SÄ±navÄ± Bitir ve Kaydet</button>
                </div>
            </div>

            <div class="results-section">
                <h2>SÄ±nav SonuÃ§larÄ±</h2>

                <div class="stats-overview">
                    <div class="stat-card">
                        <h3>Toplam SÄ±nav</h3>
                        <span id="totalExams">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Ortalama BaÅŸarÄ±</h3>
                        <span id="averageScore">%0</span>
                    </div>
                    <div class="stat-card">
                        <h3>En Ä°yi Ders</h3>
                        <span id="bestSubject">-</span>
                    </div>
                    <div class="stat-card">
                        <h3>En YÃ¼ksek Net</h3>
                        <span id="highestNet">0</span>
                    </div>
                </div>

                <div class="actions-section">
                    <button class="action-btn btn-compare" onclick="showCompareModal()" title="Ä°ki sÄ±navÄ± karÅŸÄ±laÅŸtÄ±r">
                        ğŸ“Š SÄ±nav KarÅŸÄ±laÅŸtÄ±r
                    </button>
                    <button class="action-btn btn-export" onclick="exportData()"
                        title="Verilerinizi JSON olarak indirin">
                        ğŸ’¾ Verileri DÄ±ÅŸa Aktar
                    </button>
                    <button class="action-btn btn-import" onclick="document.getElementById('importFile').click()"
                        title="Yedekten veri yÃ¼kleyin">
                        ğŸ“¥ Verileri Ä°Ã§e Aktar
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;"
                        onchange="importData(event)">
                    <button class="action-btn btn-clear" onclick="clearAllData()" title="TÃ¼m verileri sil">
                        ğŸ—‘ï¸ Verileri Temizle
                    </button>
                </div>

                <div class="graphs-section" id="graphsSection" style="display: none;">
                    <h3>Grafiklerle GeliÅŸim Takibi</h3>
                    <div class="chart-container">
                        <canvas id="netChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="subjectChart"></canvas>
                    </div>
                </div>

                <div class="exam-table-container">
                    <h3>Ders BazÄ±nda SonuÃ§lar</h3>
                    <div class="table-wrapper">
                        <table id="examTable" class="exam-table">
                            <thead>
                                <tr>
                                    <th>Ders</th>
                                    <th>DoÄŸru</th>
                                    <th>YanlÄ±ÅŸ</th>
                                    <th>Net</th>
                                    <th>BaÅŸarÄ± %</th>
                                </tr>
                            </thead>
                            <tbody id="examTableBody">
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td><strong>TOPLAM</strong></td>
                                    <td id="totalCorrect">0</td>
                                    <td id="totalWrong">0</td>
                                    <td id="totalNet">0</td>
                                    <td id="totalScore">%0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <div class="recent-exams">
                    <div class="section-header">
                        <h3>Kaydedilen SÄ±navlar</h3>
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all"
                                onclick="filterExams('all')">TÃ¼mÃ¼</button>
                            <button class="filter-btn" data-filter="hmgs" onclick="filterExams('hmgs')">HMGS</button>
                            <button class="filter-btn" data-filter="hakimlik-savcilik"
                                onclick="filterExams('hakimlik-savcilik')">Hakimlik/SavcÄ±lÄ±k</button>
                        </div>
                    </div>
                    <div id="savedExams" class="exam-list">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobil Uygulama Ä°ndirme Banner'Ä± -->
    <div id="mobileInstallBanner" class="mobile-install-banner" style="display: none;">
        <div class="banner-content">
            <div class="banner-icon">ğŸ“±</div>
            <div class="banner-text">
                <h4>Mobil Uygulama Olarak Ä°ndirmek Ä°ster Misiniz?</h4>
                <p>UygulamayÄ± ana ekranÄ±nÄ±za ekleyerek daha hÄ±zlÄ± eriÅŸim saÄŸlayÄ±n. Ã‡evrimdÄ±ÅŸÄ± Ã§alÄ±ÅŸÄ±r!</p>
            </div>
            <div class="banner-actions">
                <button id="mobileInstallBtn" class="btn btn-primary">Evet, Ä°ndir</button>
                <button id="mobileDismissBtn" class="btn btn-secondary">HayÄ±r, TeÅŸekkÃ¼rler</button>
            </div>
            <button class="banner-close" id="mobileBannerClose">âœ•</button>
        </div>
    </div>

    <!-- PWA Install Prompt (Eski - yedek olarak tutuluyor) -->
    <div id="pwaInstallPrompt" class="pwa-install-prompt" style="display: none;">
        <div class="pwa-content">
            <div class="pwa-icon">ğŸ“±</div>
            <div class="pwa-text">
                <h4>Ana Ekrana Ekle</h4>
                <p>Bu uygulamayÄ± ana ekranÄ±nÄ±za ekleyerek daha hÄ±zlÄ± eriÅŸim saÄŸlayÄ±n!</p>
            </div>
            <div class="pwa-actions">
                <button id="pwaInstallBtn" class="btn btn-primary">Ekle</button>
                <button id="pwaDismissBtn" class="btn btn-secondary">Sonra</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js', {
                    scope: './'
                })
                    .then(registration => {
                        console.log('Tyt Takip SW kaydÄ± baÅŸarÄ±lÄ±. Kapsam:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Tyt Takip SW kaydÄ± baÅŸarÄ±sÄ±z:', error);
                    });
            });
        }

        let deferredPrompt;
        const mobileInstallBanner = document.getElementById('mobileInstallBanner');
        const mobileInstallBtn = document.getElementById('mobileInstallBtn');
        const mobileDismissBtn = document.getElementById('mobileDismissBtn');
        const mobileBannerClose = document.getElementById('mobileBannerClose');
        const pwaInstallPrompt = document.getElementById('pwaInstallPrompt');
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        const pwaDismissBtn = document.getElementById('pwaDismissBtn');

        // Banner'Ä±n daha Ã¶nce gÃ¶sterilip gÃ¶sterilmediÄŸini kontrol et
        const bannerDismissed = localStorage.getItem('mobileBannerDismissed');
        const bannerShowTime = localStorage.getItem('mobileBannerShowTime');
        const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000); // 7 gÃ¼n

        // iOS iÃ§in Ã¶zel kontrol
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

        // EÄŸer zaten yÃ¼klÃ¼yse banner gÃ¶sterme
        if (isStandalone) {
            console.log('Uygulama zaten yÃ¼klÃ¼');
        } else {
            // Mobil cihaz kontrolÃ¼
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            // EÄŸer mobil cihazsa ve daha Ã¶nce reddedilmediyse veya 7 gÃ¼n geÃ§tiyse banner gÃ¶ster
            if (isMobile && (!bannerDismissed || (bannerShowTime && parseInt(bannerShowTime) < oneWeekAgo))) {
                // Sayfa yÃ¼klendikten 3 saniye sonra banner gÃ¶ster
                setTimeout(() => {
                    if (mobileInstallBanner) {
                        mobileInstallBanner.style.display = 'block';
                        mobileInstallBanner.classList.add('show');
                    }
                }, 3000);
            }
        }

        // PWA Install Prompt (Android Chrome iÃ§in)
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ğŸ¯ PWA install prompt tetiklendi!');
            e.preventDefault();
            deferredPrompt = e;

            // Mobil banner'Ä± gizle, PWA prompt gÃ¶ster
            if (mobileInstallBanner) {
                mobileInstallBanner.style.display = 'none';
            }
            if (pwaInstallPrompt) {
                pwaInstallPrompt.style.display = 'block';
            }
        });

        // Mobil banner install butonu (Android iÃ§in PWA, iOS iÃ§in yÃ¶nlendirme)
        if (mobileInstallBtn) {
            mobileInstallBtn.addEventListener('click', () => {
                if (isIOS) {
                    // iOS iÃ§in App Store veya talimat gÃ¶ster
                    showIOSInstallInstructions();
                    if (mobileInstallBanner) {
                        mobileInstallBanner.style.display = 'none';
                        localStorage.setItem('mobileBannerDismissed', 'true');
                        localStorage.setItem('mobileBannerShowTime', Date.now().toString());
                    }
                } else if (deferredPrompt) {
                    // Android iÃ§in PWA install
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('âœ… PWA kurulumu kabul edildi');
                            if (mobileInstallBanner) {
                                mobileInstallBanner.style.display = 'none';
                            }
                        } else {
                            console.log('âŒ PWA kurulumu reddedildi');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    // PWA desteklenmiyorsa genel talimatlar
                    showInstallInstructions();
                }
            });
        }

        // Banner'Ä± kapat
        if (mobileDismissBtn) {
            mobileDismissBtn.addEventListener('click', () => {
                if (mobileInstallBanner) {
                    mobileInstallBanner.style.display = 'none';
                    localStorage.setItem('mobileBannerDismissed', 'true');
                    localStorage.setItem('mobileBannerShowTime', Date.now().toString());
                }
            });
        }

        if (mobileBannerClose) {
            mobileBannerClose.addEventListener('click', () => {
                if (mobileInstallBanner) {
                    mobileInstallBanner.style.display = 'none';
                    localStorage.setItem('mobileBannerDismissed', 'true');
                    localStorage.setItem('mobileBannerShowTime', Date.now().toString());
                }
            });
        }

        // iOS kurulum talimatlarÄ± fonksiyonu
        function showIOSInstallInstructions() {
            const modal = document.createElement('div');
            modal.className = 'exam-detail-modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>ğŸ“± iOS'ta Ana Ekrana Ekleme</h3>
                        <button class="close-btn">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="install-instructions">
                            <ol style="line-height: 2; padding-left: 20px;">
                                <li>Safari tarayÄ±cÄ±sÄ±nÄ±n alt kÄ±smÄ±ndaki <strong>PaylaÅŸ</strong> (â¬†ï¸) butonuna dokunun</li>
                                <li>AÃ§Ä±lan menÃ¼den <strong>"Ana Ekrana Ekle"</strong> seÃ§eneÄŸini seÃ§in</li>
                                <li>Uygulama adÄ±nÄ± onaylayÄ±n ve <strong>"Ekle"</strong> butonuna dokunun</li>
                                <li>Uygulama ana ekranÄ±nÄ±za eklenecektir!</li>
                            </ol>
                            <p style="margin-top: 20px; color: #718096; font-size: 0.9rem;">
                                ğŸ’¡ Chrome kullanÄ±yorsanÄ±z, Safari ile aÃ§manÄ±z gerekebilir.
                            </p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close-btn');
            closeBtn.addEventListener('click', () => modal.remove());
            modal.addEventListener('click', function (e) {
                if (e.target === modal) modal.remove();
            });
        }

        // Genel kurulum talimatlarÄ±
        function showInstallInstructions() {
            const modal = document.createElement('div');
            modal.className = 'exam-detail-modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>ğŸ“± Ana Ekrana Ekleme</h3>
                        <button class="close-btn">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="install-instructions">
                            <p style="margin-bottom: 15px;"><strong>TarayÄ±cÄ± menÃ¼sÃ¼nden "Ana Ekrana Ekle" veya "Add to Home Screen" seÃ§eneÄŸini kullanabilirsiniz.</strong></p>
                            <ul style="line-height: 2; padding-left: 20px;">
                                <li><strong>Android Chrome:</strong> MenÃ¼ (â‹®) â†’ Ana Ekrana Ekle</li>
                                <li><strong>Android Firefox:</strong> MenÃ¼ â†’ SayfayÄ± Ekle â†’ Ana Ekran</li>
                                <li><strong>iOS Safari:</strong> PaylaÅŸ (â¬†ï¸) â†’ Ana Ekrana Ekle</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close-btn');
            closeBtn.addEventListener('click', () => modal.remove());
            modal.addEventListener('click', function (e) {
                if (e.target === modal) modal.remove();
            });
        }

        if (pwaInstallBtn) {
            pwaInstallBtn.addEventListener('click', () => {
                if (pwaInstallPrompt) pwaInstallPrompt.style.display = 'none';
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('âœ… Tyt PWA kurulumu kabul edildi');
                        } else {
                            console.log('âŒ Tyt PWA kurulumu reddedildi');
                        }
                        deferredPrompt = null;
                    });
                }
            });
        }

        if (pwaDismissBtn) {
            pwaDismissBtn.addEventListener('click', () => {
                if (pwaInstallPrompt) pwaInstallPrompt.style.display = 'none';
                // 24 saat boyunca tekrar gÃ¶sterme
                localStorage.setItem('pwaInstallDismissed', 'true');
                localStorage.setItem('pwaInstallPromptTime', Date.now().toString());
            });
        }

        window.addEventListener('appinstalled', (evt) => {
            console.log('ğŸ‰ Tyt PWA baÅŸarÄ±yla kuruldu!');
            if (pwaInstallPrompt) pwaInstallPrompt.style.display = 'none';
        });
    </script>
</body>

</html>